<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <title>Seattle Development Map</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.js"></script>
  <style>
    #map {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        height: 100%;
    }
  </style>
</head>



<body>
  <div id="map"></div>
  <div class="map-overlay" id="sidebar"></div>


  <script>
    mapboxgl.accessToken =
      'pk.eyJ1Ijoia2V2b2dyYXBoeSIsImEiOiJja3dhNWo2YjUyZ2V6MnFtbndndHhsYzF5In0.r9-h3pU6NGSjtbmv0ADErg';

    const map = new mapboxgl.Map({
      container: 'map', // container ID
      // CHANGE TO CUSTOM
      style: 'mapbox://styles/mapbox/light-v10', // style URL
      zoom: 10.5, // starting zoom
      center: [-122.33, 47.614] // starting center
    });

    //geojson async function
    async function geojsonFetch() {
      //load data
      let response, sfh_sales, housing_units, point_units;
      response = await fetch('assets/sfh_mfh_units_2006-2015.geojson');
      housing_units = await response.json();
      response = await fetch('assets/sfh_saleprices_censustract_2006-2015.geojson')
      sfh_sales = await response.json();
      response = await fetch('assets/sfh_mfh_units_2006-2015_points.geojson')
      point_units = await response.json();
      //map loading
      map.on('load', () => {
        //create default filters *to be implemented*
        //let filterYearUnits = ['==', ['number', ['get', 'YR_BUILT']], 2015];
        let filterYear =['==', ['number', ['get', 'YEAR']], 2015];

        //add sales price layer
        map.addLayer({
          'id': 'sfh_sales_layer',
          'type': 'fill',
          'source': {
            type: 'geojson',
            data: sfh_sales
          },
          //paint style to be implemented
          'paint': {
            'fill-color': [
              'interpolate',
              ['linear'],
              ['number', ['get', 'PRICE_SQFT']],
              0, '#FFFFFF',
              1, '#f7fcf5',
              109, '#caeac3',
              219, '#7bc87c',
              328, '#2a924a',
              548, '#00441b'
            ],
            'fill-outline-color': '#3f3f3f',
            'fill-opacity': 0.65
          },
          'filter': ['all', filterYear]
        });//end of sales price layer


        // add layer for housing units
        map.addLayer({
          'id': 'housing_units_layer',
          'type': 'fill',
          'source': {
              type: 'geojson',
              data: housing_units
          },
          'paint': {
            'fill-color': ['match', ['string',['get','LAND_USE_1']],
              'Single Family', '#0031E7',
              'Multi-Family', '#F70000',
              'Commercial/Mixed-Use', '#00F700',
              'Industrial','#FF7900',
              'Major Institution And Public Facilities/Utilities', '#F0E132',
              'Vacant', '#8F3985',
              'Unknown', '#000000',
              '#CCCCCC'
            ],
            'fill-outline-color': '#3f3f3f',
            'fill-opacity': 0.4
          },
          'filter': ['all', filterYear]
        }); // end of housing units layer func


        // add layer for housing units as points
        map.addLayer({
          'id': 'point_units_layer',
          'type': 'circle',
          'source': {
              type: 'geojson',
              data: point_units
          },
          'paint': {
            'circle-color': ['match', ['string',['get','LAND_USE_1']],
              'Single Family', '#0031E7',
              'Multi-Family', '#F70000',
              'Commercial/Mixed-Use', '#00F700',
              'Industrial','#FF7900',
              'Major Institution And Public Facilities/Utilities', '#F0E132',
              'Vacant', '#8F3985',
              'Unknown', '#000000',
              '#CCCCCC'
            ],
            'circle-radius': {
              'base': 3.5,
              'stops': [
                [10.5, 3.5],
                [13.5, 0]
              ]
            },
            'circle-opacity': 0.9
          },
          'filter': ['all', filterYear]
        }); // end of housing units layer func


      }); //end of map.on


    } // end of geojsonFetch
    geojsonFetch();


  </script>
</body>
</html>
